\chapter{Mean-Field Theory in Hubbard lattices}\label{appendix:mean-field-hubbard}

In this Appendix the Mean-Field solutions to the Hubbard hamiltonian,
\[
	\hat H = 
	-t \sum_{\langle ij \rangle} \sum_\sigma \hat c_{i\sigma}^\dagger \hat c_{j\sigma}
	+ U \sum_i \hat n_{i\uparrow} \hat n_{i\downarrow}
	\qquad
	t, U  > 0
\]
are described. The discussion is limited to the two-dimensional square lattice. The two-dimensional square lattice extension of the two-sites model can be studied by the means of Mean Field Theory. We have:
\[
\begin{aligned}
	\hat n_{i\uparrow} \hat n_{i\downarrow} &= \left( \ev{\hat n_{i\uparrow}} + \delta \hat n_{i\uparrow} \right) \left( \ev{\hat n_{i\downarrow}} + \delta \hat n_{i\downarrow} \right) \\
	&\simeq \ev{\hat n_{i\uparrow}} \ev{\hat n_{i\downarrow}} +  \delta \hat n_{i\uparrow} \ev{\hat n_{i\downarrow}} + \ev{\hat n_{i\uparrow}} \delta \hat n_{i\downarrow} + \mathcal{O} \left(\delta n^2\right) \\
	&= - \ev{\hat n_{i\uparrow}} \ev{\hat n_{i\downarrow}} + \hat n_{i\uparrow} \ev{\hat n_{i\downarrow}} + \ev{\hat n_{i\uparrow}} \hat n_{i\downarrow} + \mathcal{O} \left(\delta n^2\right)
\end{aligned}
\]
where $\delta \hat n_{i\sigma} \equiv \hat n_{i\sigma} - \ev{\hat n_{i\sigma}}$ and orders higher than first have been ignored, assuming negligible fluctuations around the equilibrium single-site population. The first term of the above three can be neglected at fixed particles number, being a pure energy shift. 

\section{Ferromagnetic solution}

The Mean-Field Theory ferromagnetic solution prescribes an uniformly magnetized lattice,
\[
	\ev{\hat n_{i\uparrow}} = n+m
	\qquad
	\ev{\hat n_{i\downarrow}} = n-m
\]
where $n$ is the site electron density and $m$ is the density unbalance, leading to a magnetization per site $2m$. The mean-field hamiltonian with these substitutions becomes:
\[
\begin{aligned}
	\hat H &\simeq 
	-t \sum_{\langle ij \rangle} \sum_\sigma \hat c_{i\sigma}^\dagger \hat c_{j\sigma}
	+ U \sum_i \left[
		\hat n_{i\uparrow} \ev{\hat n_{i\downarrow}} + \ev{\hat n_{i\uparrow}} \hat n_{i\downarrow} 
	\right] \\
	&= -t \sum_{\langle ij \rangle} \sum_\sigma \hat c_{i\sigma}^\dagger \hat c_{j\sigma}
	+ nU \sum_i \left[
		\hat n_{i\uparrow} + \hat n_{i\downarrow} 
	\right] - mU \sum_i \left[
		\hat n_{i\uparrow} - \hat n_{i\downarrow} 
	\right]
\end{aligned}
\]
Fourier transforming,
\[
\begin{aligned}
	-t \sum_{\langle ij \rangle} \sum_\sigma \hat c_{i\sigma}^\dagger \hat c_{j\sigma} &= -2t \sum_{\mathbf{k}\sigma} \left[
		\cos(k_x) + \cos(k_y)
	\right] \hat n_{\mathbf{k}\sigma} \\
	nU \sum_i \left[
		\hat n_{i\uparrow} + \hat n_{i\downarrow} 
	\right] &= nU \sum_{\mathbf{k}\sigma} \hat n_{\mathbf{k}\sigma} \\
	mU \sum_i \left[
		\hat n_{i\uparrow} - \hat n_{i\downarrow} 
	\right] &= mU \sum_{\mathbf{k}\sigma} \left[
		\hat n_{\mathbf{k}\uparrow} - \hat n_{\mathbf{k}\downarrow}
	\right]
\end{aligned}
\]
having used adimensional lattice momenta. For a square lattice, the Brillouin Zone is delimited by
\[
	\mathbf{k} \in [-\pi,\pi] \times [-\pi,\pi]
\]
The hopping single-state energy is given by
\[
	\epsilon_{\mathbf{k}}^{(0)} = -2t \left[
		\cos(k_x) + \cos(k_y)
	\right]
\]
represented as a band in Fig.~\ref{appfig:ferromagnetic-3d-band}. At $U=0$, the mean-field ferromagnetic state fills the band bottom-up. The single-state energy becomes:
\[
\begin{aligned}
	\epsilon_{\mathbf{k}\uparrow} &= U \left(
		n-m
	\right) - 2t \left[
		\cos(k_x) + \cos(k_y)
	\right] \\
	\epsilon_{\mathbf{k}\downarrow} &= U \left(
		n+m
	\right) - 2t \left[
		\cos(k_x) + \cos(k_y)
	\right]
\end{aligned}
\]
Now it is a matter of finding the optimal value for $m$, minimizing the total energy at fixed filling $\rho = 2n$. Notice that said minimization is performed parametrically varying the magnetization $m$, inside the ferromagnetic-polarized space. As it turns out, for strong local repulsion $U/t \gg 1$, antiferromagnetic ordering is preferred. Comparison is needed in order to assess which magnetic ordering is preferred.

Consider the half-filling situation. An unpolarized system will have $n=1/4$, $m=0$: this implies $\ev{\hat n_{i\uparrow}} = \ev{\hat n_{i\downarrow}} = 1/4$. A perfectly up-ferromagnetic system, $n=1/4$, $m=1/4$: then $\ev{\hat n_{i\uparrow}} = 1/2$ and $\ev{\hat n_{i\downarrow}} = 0$. \todo

\begin{figure}
	\centering
	\input{appendices/mean-field-hubbard/pictures/ferromagnetic-3d-band}
	\caption{Depiction of the Hubbard square lattice hopping band $\epsilon_{\mathbf{k}}^{(0)} = -2t[\cos(k_x) + \cos(k_y)]$. The red lines mark the zero-energy intersection.}
	\label{appfig:ferromagnetic-3d-band}
\end{figure}

{\color{tabred} Unclear: numerically, it turns out the paramagnetic phase ($m=0$) is preferred. Let $\Delta \equiv Um$ and ignore the constant contribution to energies $Un$: graphically, the $\uparrow$ band is shifted by $\Delta$, the $\downarrow$ band by $-\Delta$. At half-filling the Fermi energy remains fixed. For each quadrant (top view of the bands), the DoS is inversion-symmetric with respect to the anti-diagonal (red lines in Fig.~\ref{appfig:ferromagnetic-3d-band}), thus filling the bands bottom-up while performing the shifts should leave the total energy unchanged. Why is $m=0$ preferred?}

\section{Antiferromagnetic solution}

Consider now an AF mean-field solution. Let me change notation for a brief moment, indicating each site as
\[
	i \to \mathbf{r} = (x,y)
	\qquad
	x,y \in \mathbb{N}
\]
The mean-field AF solution at half-filling is the uniform-modulated magnetization
\[
	m_\mathbf{r} = (-1)^{x+y} m
	\qquad
	m \in [-1,1]
\]
and a mean-field Ansatz
\[
	\ev{\hat n_{\mathbf{r}\uparrow}} = n+m_\mathbf{r}
	\qquad
	\ev{\hat n_{\mathbf{r}\downarrow}} = n-m_\mathbf{r}
\]
With respect to the solution presented above, the only detail changing is the last term,
\begin{equation}\label{appeq:hubbard-mean-field-hamiltonian}
	\hat H = -t \sum_{\langle \mathbf{r}\mathbf{r}' \rangle} \sum_\sigma \hat c_{\mathbf{r}\sigma}^\dagger \hat c_{\mathbf{r}'\sigma}
	+ nU \sum_\mathbf{r} \left[
		\hat n_{\mathbf{r}\uparrow} + \hat n_{\mathbf{r}\downarrow}
	\right] - mU \sum_\mathbf{r} (-1)^{x+y} \left[
		\hat n_{\mathbf{r}\uparrow} - \hat n_{\mathbf{r}\downarrow}
	\right]
\end{equation}
Fourier-transforming, the phase factor can be absorbed in the destruction operator inside of $\hat n_{\mathbf{r}\sigma}$:
\[
\begin{aligned}
	\sum_\mathbf{r} (-1)^{x+y} \hat n_{\mathbf{r}\sigma} &= \sum_\mathbf{r} (-1)^{x+y} \hat c_{\mathbf{r}\sigma}^\dagger \hat c_{\mathbf{r}\sigma} \\
	&= 
	\sum_\mathbf{r} e^{i \bm{\pi} \cdot \mathbf{r}}
	\frac{1}{N} \sum_{\mathbf{k} \in \mathrm{BZ}} e^{i \mathbf{k} \cdot \mathbf{r}} \hat c_{\mathbf{k}\sigma}^\dagger \frac{1}{N} \sum_{\mathbf{k}' \in \mathrm{BZ}} e^{-i \mathbf{k}' \cdot \mathbf{r}} \hat c_{\mathbf{k}'\sigma} \\
	&= \sum_{\mathbf{k} \in \mathrm{BZ}} \sum_{\mathbf{k}' \in \mathrm{BZ}} \hat c_{\mathbf{k}\sigma}^\dagger \hat c_{\mathbf{k}'\sigma} \frac{1}{N^2} \sum_\mathbf{r} e^{-i [\mathbf{k}' - (\mathbf{k} + \bm{\pi}) ] \cdot \mathbf{r}} \\
	&= \sum_{\mathbf{k} \in \mathrm{BZ}} \hat c_{\mathbf{k}\sigma}^\dagger \hat c_{\mathbf{k}+\bm{\pi}\sigma}
\end{aligned}
\]
where $\bm{\pi} = (\pi,\pi)$. It follows:
\[
mU \sum_\mathbf{r} (-1)^{x+y} \left[
		\hat n_{\mathbf{r}\uparrow} - \hat n_{\mathbf{r}\downarrow}
	\right] = \Delta \sum_{\mathbf{k} \in \mathrm{BZ}} \left[
		\hat c_{\mathbf{k}\uparrow}^\dagger \hat c_{\mathbf{k}+\bm{\pi}\uparrow} - \hat c_{\mathbf{k}\downarrow}^\dagger \hat c_{\mathbf{k}+\bm{\pi}\downarrow}
	\right]
	\qq{where}
	\Delta \equiv mU
\]

\begin{figure}
	\centering
	\subfloat[Alternative band.]{
		\input{appendices/mean-field-hubbard/pictures/alternative-ferromagnetic-3d-band}
		\label{appsubfig:alternative-ferromagnetic-3d-band}
	}
	\subfloat[Contour plot.]{
		\input{appendices/mean-field-hubbard/pictures/ferromagnetic-contour}
		\label{appsubfig:ferromagnetic-contour}
	}
	\caption{Alternative depiction of the Hubbard square lattice hopping band previously reported in Fig.~\ref{appfig:ferromagnetic-3d-band}. The Magnetic Brillouin Zone ($\mathrm{MBZ}$) is delimited by the zero-energy contour and is indicated in figure. As it is evident, energy sign flips by taking a $(\pi,\pi)$ translation in $\mathbf{k}$ space.}
	\label{appfig:alternative-ferromagnetic-band}
\end{figure}

Consider the band of Fig.~\ref{appfig:ferromagnetic-3d-band} at half-filling. As does \citeauthor{fabrizio2022course} \cite{fabrizio2022course}, the area delimited externally by the solid lines at zero energy is denominated ``Magnetic Brillouin Zone'' ($\mathrm{MBZ}$). The periodicity of $\mathbf{k}$ space guarantees that the full $\mathrm{BZ}$ can be taken as well to be the one of Fig.~\ref{appsubfig:alternative-ferromagnetic-3d-band}. Then:
\begin{align}
	\sum_{\mathbf{k} \in \mathrm{BZ}}
	\hat c_{\mathbf{k}\uparrow}^\dagger \hat c_{\mathbf{k}+\bm{\pi}\uparrow} &= \sum_{\mathbf{k} \in \mathrm{MBZ}}
	\left[
		\hat c_{\mathbf{k}\uparrow}^\dagger \hat c_{\mathbf{k}+\bm{\pi}\uparrow} + \hat c_{\mathbf{k}+\bm{\pi}\uparrow}^\dagger \hat c_{\mathbf{k}+2\bm{\pi}\uparrow}
	\right] \nonumber \\
	&= \sum_{\mathbf{k} \in \mathrm{MBZ}}
	\left[
		\hat c_{\mathbf{k}\uparrow}^\dagger \hat c_{\mathbf{k}+\bm{\pi}\uparrow} + \hat c_{\mathbf{k}+\bm{\pi}\uparrow}^\dagger \hat c_{\mathbf{k}\uparrow}
	\right] \label{appeq:mixed-cc-term-intermediate-passage}
\end{align}
and the same applies for spin $\downarrow$. Periodicity by shifts $2\bm{\pi}$ has been used. Now, define the Nambu spinors:
\[
	\hat \Psi_{\mathbf{k}\sigma} \equiv \begin{bmatrix}
		\hat c_{\mathbf{k}\sigma} \\
		\hat c_{\mathbf{k}+\bm{\pi}\sigma} 
	\end{bmatrix}
\]
and a spin-wise gap,
\[
	\Delta_\uparrow = \Delta
	\qquad
	\Delta_\downarrow = -\Delta
\]
At fixed filling, the $U$ term is a pure energy shift, thus will be neglected. The kinetic term transforms as
\[
\begin{aligned}
	-t \sum_{\langle ij \rangle} \sum_\sigma \hat c_{i\sigma}^\dagger \hat c_{j\sigma} &= \sum_{\mathbf{k} \in \mathrm{BZ}} \sum_\sigma \epsilon_\mathbf{k}^{(0)} \hat c_{\mathbf{k}\sigma}^\dagger \hat c_{\mathbf{k}\sigma} \\ 
	&= \sum_{\mathbf{k} \in \mathrm{MBZ}} \sum_\sigma \left[
		\epsilon_\mathbf{k}^{(0)} \hat c_{\mathbf{k}\sigma}^\dagger \hat c_{\mathbf{k}\sigma}
		+ \epsilon_{\mathbf{k}+\bm{\pi}}^{(0)} \hat c_{\mathbf{k}+\bm{\pi}\sigma}^\dagger \hat c_{\mathbf{k}+\bm{\pi}\sigma}
	\right] \\
	&= \sum_{\mathbf{k} \in \mathrm{MBZ}} \sum_\sigma \epsilon_{\mathbf{k}}^{(0)}  \left[
		\hat c_{\mathbf{k}\sigma}^\dagger \hat c_{\mathbf{k}\sigma}
		- \hat c_{\mathbf{k}+\bm{\pi}\sigma}^\dagger \hat c_{\mathbf{k}+\bm{\pi}\sigma}
	\right] \\ 
\end{aligned}
\]
In the second passage, the sum over the full $\mathrm{BZ}$ was written considering that the entirety of the zone is given by all the points in the $\mathrm{MBZ}$ plus their conjugates obtained by a $\bm{\pi}$ shift in the flipped band. As depicted in Fig.~\ref{appsubfig:alternative-ferromagnetic-3d-band}, kinetic energy is anti-periodic in $\mathbf{k}$ space by a vector $\bm{\pi}$. This anti-periodicity accounts for the minus sign arising in the third passage. The hamiltonian is then given by:
\begin{equation}\label{appeq:hubbard-bogoliubov-hamiltonian}
	\hat H = \sum_{\mathbf{k} \in \mathrm{MBZ}} \sum_\sigma \hat \Psi_{\mathbf{k}\sigma}^\dagger h_{\mathbf{k}\sigma} \hat \Psi_{\mathbf{k}\sigma}
	\qq{being}
	h_{\mathbf{k}\sigma} \equiv \begin{bmatrix}
		\epsilon_\mathbf{k}^{(0)} & -\Delta_\sigma \\
		-\Delta_\sigma & - \epsilon_\mathbf{k}^{(0)}
	\end{bmatrix}
\end{equation}
Notice: the Nambu hamiltonian is a $2\times2$ matrix over the $\mathrm{MBZ}$ -- which is half the full $\mathrm{BZ}$, coherently with a solution which essentially bipartites the lattice giving back a double sized unit cell.

\begin{figure}
	\centering
	\input{appendices/mean-field-hubbard/pictures/pseudo-magnetic-field}
	\caption{Pseudo-magnetic field originating from mean-field treatment of the square Hubbard hamiltonian. Here, only the $\sigma=\uparrow$}
	\label{appfig:pseudo-magnetic-field}
\end{figure}

The system ground-state is obtained by the means of a Bogoliubov rotation. The hamiltonian maps onto the simple one of a spin in a magnetic field,
\[
	h_{\mathbf{k}\sigma} = \epsilon_\mathbf{k}^{(0)} \tau^x - \Delta_\sigma \tau^z
\]
being $\tau^\alpha$ the Pauli matrices. Then, defining
\[
	\hat s_{\mathbf{k}\sigma}^\alpha \equiv \hat \Psi_{\mathbf{k}\sigma}^\dagger \tau^\alpha \hat \Psi_{\mathbf{k}\sigma}
	\qq{and}
	\mathbf{b}_{\mathbf{k}\sigma} \equiv \begin{bmatrix}
		\epsilon_\mathbf{k}^{(0)} \\ 0 \\ -\Delta_\sigma
	\end{bmatrix}
\]
one gets:
\begin{equation}\label{appeq:hubbard-bogoliubov-hamiltonian-pseudofields}
	\hat H = \sum_{\mathbf{k} \in \mathrm{MBZ}} \sum_\sigma \mathbf{b}_{\mathbf{k}\sigma} \cdot \hat{\mathbf{s}}_{\mathbf{k}\sigma}
	\qq{where}
	\hat{\mathbf{s}}_{\mathbf{k}\sigma} = \begin{bmatrix}
		\hat s_{\mathbf{k}\sigma}^x \\
		\hat s_{\mathbf{k}\sigma}^y \\
		\hat s_{\mathbf{k}\sigma}^z
	\end{bmatrix}
\end{equation}
The hamiltonian represents a system of spins subject to local magnetic fields, each tilted by an angle $\tan(2\theta_{\mathbf{k}\sigma}) = \Delta_\sigma/\epsilon_{\mathbf{k}}^{(0)}$, as sketched in Fig.~\ref{appfig:pseudo-magnetic-field}. At any finite temperature, the ground-state of such a system is well-known. Diagonalization of each $h_{\mathbf{k}\sigma}$ is obtained trivially by a simple rotation around the $y$ axis:
\[
	d_{\mathbf{k}\sigma} = W_{\mathbf{k}\sigma} h_{\mathbf{k}\sigma} W_{\mathbf{k}\sigma}^\dagger
\]
where
\[
	d_{\mathbf{k}\sigma} = \begin{bmatrix}
		E_\mathbf{k} & \\
		& - E_\mathbf{k}
	\end{bmatrix}
	\qq{and}
	W_{\mathbf{k}\sigma} = e^{i\theta_{\mathbf{k}}\tau^y}
\]
Eigenvalues are:
\[
	E_\mathbf{k} \equiv \sqrt{\epsilon_{\mathbf{k}}^2 + \abs{\Delta_\sigma}^2}
\]
(superscript ``$(0)$'' has been dropped momentarily). Notice that the presence of an absolute value makes the eigenvalues independent of the $\sigma$ index. Eigenvectors are obtained simply as:
\[
	\hat \Phi_{\mathbf{k}\sigma} = W_{\mathbf{k}\sigma} \hat \Psi_{\mathbf{k}\sigma}
\]
\todo

\subsection{Theoretical mean-field solution}

A convergence algorithm can be designed to find the Hartree-Fock solution to the model. Ultimately, we aim to extract $m$ self-consistently. Since
\[
\begin{aligned}
	m &= \frac{1}{2L^2} \sum_\mathbf{r} (-1)^{x+y} \left\langle
		\hat n_{\mathbf{r}\uparrow} - \hat n_{\mathbf{r}\downarrow}
	\right\rangle \\
	&= \frac{1}{2L^2} \sum_{\mathbf{k} \in \mathrm{BZ}} \left\langle
		\hat c_{\mathbf{k}\uparrow}^\dagger \hat c_{\mathbf{k}+\bm{\pi}\uparrow} - \hat c_{\mathbf{k}\downarrow}^\dagger \hat c_{\mathbf{k}+\bm{\pi}\downarrow}
	\right\rangle \\
	&= \frac{1}{2L^2} \sum_{\mathbf{k} \in \mathrm{MBZ}} \left\langle
			\left(
				\hat c_{\mathbf{k}\uparrow}^\dagger \hat c_{\mathbf{k}+\bm{\pi}\uparrow} + \hat c_{\mathbf{k}+\bm{\pi}\uparrow}^\dagger \hat c_{\mathbf{k}\uparrow}	
			\right) - \left(
				\hat c_{\mathbf{k}\downarrow}^\dagger \hat c_{\mathbf{k}+\bm{\pi}\downarrow} + \hat c_{\mathbf{k}+\bm{\pi}\downarrow}^\dagger \hat c_{\mathbf{k}\downarrow}	
			\right)
		\right\rangle
\end{aligned}
\]
In the last passage, Eq.~\eqref{appeq:mixed-cc-term-intermediate-passage} has been used. Then magnetization can be computed simply as
\begin{equation}\label{appeq:antiferromagnet-magnetization-self-consistence-abstract}
	m = \frac{1}{2L^2} \sum_{\mathbf{k} \in \mathrm{MBZ}} \left[
		\left\langle 
			\hat \Psi_{\mathbf{k}\uparrow}^\dagger \tau^x \hat \Psi_{\mathbf{k}\uparrow}
		\right\rangle - \left\langle 
			\hat \Psi_{\mathbf{k}\downarrow}^\dagger \tau^x \hat \Psi_{\mathbf{k}\downarrow}
		\right\rangle
	\right]
\end{equation}
In this equation, spin expectation values appear:
\[
	\left\langle 
		\hat \Psi_{\mathbf{k}\sigma}^\dagger \tau^x \hat \Psi_{\mathbf{k}\sigma}
	\right\rangle = \ev{\hat s_{\mathbf{k}\sigma}^x}
\]
For a spin system at zero temperature, the spin operator expectation value anti-aligns with the external field,
\[
	\ev{\hat s_{\mathbf{k}\sigma}^x} = \sin(2\theta_{\mathbf{k}\sigma})
\]
(see Fig.~\ref{appfig:pseudo-magnetic-field}). Now, since $\Delta_\downarrow = - \Delta_\uparrow$, it follows
\[
	\theta_{\mathbf{k}\downarrow} = -\theta_{\mathbf{k}\uparrow}
\]
Then, from Eq.~\eqref{appeq:antiferromagnet-magnetization-self-consistence-abstract} finally:
\begin{equation}\label{appeq:antiferromagnet-magnetization-self-consistence-final}
	m = \frac{1}{L^2} \sum_{\mathbf{k} \in \mathrm{MBZ}} \sin(2\theta_{\mathbf{k}\sigma})
\end{equation}
\todo

\subsection{Real space mean-field iterative algorithmic solution}

The theoretical derivation of the above paragraph offers a simple description of the system anti-ferromagnetic instability as the instauration of a ground-state of quasiparticles. Here a self-consistent algorithmic extraction of the expected magnetization is presented, following \cite{scholle2023comprehensive}. Consider a square lattice of $L_x \times L_y$ sites: the hamiltonian will be a matrix of dimension $2L_x L_y \times 2L_x L_y$,
\[
	[ \hat H ]_{(\mathbf{r}\sigma)(\mathbf{r}'\sigma')} = \mel{\Omega}{ \hat c_{\mathbf{r}\sigma} \hat H \hat c_{\mathbf{r}'\sigma'}^\dagger}{\Omega}
\]
For simplicity, in the following $D \equiv 2L_x L_y$. In this context, the following convention is used: the rows/column index entry $\alpha=(\mathbf{r}\sigma)$ is associated to a specific site $\mathbf{r}=(x,y)$ and spin $\sigma$ through the relation
\[
	\alpha = 2j_\mathbf{r}-\delta_{\sigma=\uparrow}
	\qq{where}
	j_\mathbf{r} = x+(y-1)L_x 
\]
Let me break this through. For each site $\mathbf{r}$, two sequential indices are provided ($2j_\mathbf{r}-1$, hosting spin $\uparrow$, and $2j_\mathbf{r}$, hosting spin $\downarrow$). $j_\mathbf{r}$ just orders the site rows-wise. This way, $(x,1)$ is assigned to $j_{(x,1)}=x$, while its NN one site above $(x,2)$ is assigned to an entry shifted by $L_x$, $j_{(x,2)}=x+L_x$. This is just a way of counting the site of a finite square lattice by sweeping along a row and then moving to the row above. Fig.~\ref{appfig:square-lattice-ordering} reports a scheme of the used site ordering.

\begin{figure}
	\centering
	\input{appendices/mean-field-hubbard/pictures/square-lattice-ordering}
	\caption{Schematics of the site ordering on a square lattice performed by sweeping along rows. Left-bottom side is one corner of the lattice. Red sites are characterized by $x+y$ being odd, blue sites by being even. The number reported near to each site is the $\alpha$ entry in the matrix representation for a finite square lattice.}
	\label{appfig:square-lattice-ordering}
\end{figure}

Within this convention, matrix elements $H_{\alpha\beta}$ are defined by:
\begin{itemize}
	\item If $\sigma=\sigma'$ and $\mathbf{r}$, $\mathbf{r}'$ are NN, the matrix entry is $-t$. In terms of the used greek indices, $\alpha$ and $\beta$ satisfy said requirement if $\abs{\alpha-\beta}=2$ (horizontal hopping) or $\abs{\alpha-\beta}=2L_x$ (vertical hopping). Along column $\alpha$ of the hamiltonian matrix, the elements $-t$ appear at positions 
	\[
		( \alpha \pm 2L_x ) \mod 4L_xL_y
		\qq{and}
		( \alpha \pm 2 ) \mod 4L_xL_y
	\]
	\item If $\mathbf{r} = \mathbf{r}'$ and $\sigma=\sigma'$ (along the diagonal), the local interaction with the mean field is given by the matrix element 
	\[
		-mU \times (-1)^{x+y} \times (-1)^{\delta_{\sigma=\downarrow}}
	\]
	Starting from a given entry $\alpha$, $j_\mathbf{r}$ is retrieved simply by $j_\mathbf{r}=\lfloor \alpha/2 \rfloor$, and then
	\[
		x+y = (j_\mathbf{r}+1) - \left\lfloor
			\frac{j_\mathbf{r}}{L_x}
		\right\rfloor (L_x-1)
	\]
	Then the $j_\mathbf{r}$-th $2 \times 2$ block along the diagonal will be given by
	\[
		(-1)^{x+y} \begin{bmatrix}
			-mU & \\ & mU
		\end{bmatrix}
	\]
\end{itemize}
These prescriptions allow to build from scratch the hamiltonian matrix. After that, diagonalization provides $D$ orthonormal eigenvectors $\mathbf{v}^\ell \in \mathbb{C}^{D \times D}$ with $\ell=1,\cdots,D$, each associated to a precise eigenvalue $\epsilon^\ell \in \mathbb{R}$. Let $f$ be the Fermi-Dirac distribution at inverse temperature $\beta$ and chemical potential $\mu$,
\[
	f(\epsilon;\beta,\mu) = \frac{1}{e^{\beta(\epsilon-\mu)}+1}
\]
At equilibrium, electrons will fill up the energy eigenstates according to,
\[
	\langle
		\hat n_{\mathbf{r}\sigma}
	\rangle = \sum_{\ell=1}^D \abs{v_\alpha^\ell}^2 f(\epsilon^\ell;\beta,\mu)
	\qq{where}
	\alpha = (\mathbf{r}\sigma)
\]
For a fixed density $n = N/D$, the chemical potential must satisfy
\[
\begin{aligned}
	n &= \frac{1}{D} \sum_{\mathbf{r}\sigma} \langle
		\hat n_{\mathbf{r}\sigma}
	\rangle \\
	&= \frac{1}{D} \sum_{\mathbf{r}\sigma} \sum_{\ell=1}^D \abs{v_\alpha^\ell}^2 f(\epsilon^\ell;\beta,\mu) \\
	&= \frac{1}{D} \sum_{\ell=1}^D f(\epsilon^\ell;\beta,\mu)
\end{aligned} 
\]
since the $\mathbf{v}^\ell$ eigenvectors are orthonormal. The chemical potential for the half-filled model is already known to be
\[
	\mu \big|_{n=1/2} = -\frac{U}{2}
\]
as evident from Eq.~\eqref{appeq:hubbard-mean-field-hamiltonian}. Average magnetization is then given by
\begin{align}
	m &= \frac{1}{D} \sum_{\mathbf{r}} \left[
		\langle
			\hat n_{\mathbf{r}\uparrow}
			\rangle - \langle
			\hat n_{\mathbf{r}\downarrow}
		\rangle
	\right] \nonumber \\
	&= \frac{1}{D} \sum_{\lambda=1}^{D/2} \sum_{\ell=1}^D \left[
		\abs{v_{2\lambda-1}^\ell}^2 - \abs{v_{2\lambda}^\ell}^2
	\right] f(\epsilon^\ell;\beta,\mu) \nonumber \\
	&= \frac{1}{D} \sum_{\ell=1}^D \left[
		1 - 2 \sum_{\lambda=1}^{D/2} \abs{v_{2\lambda}^\ell}^2
	\right] f(\epsilon^\ell;\beta,\mu) \nonumber \\
	&= n - \frac{2}{D} \sum_{\ell=1}^D \sum_{\lambda=1}^{D/2} \abs{v_{2\lambda}^\ell}^2 f(\epsilon^\ell;\beta,\mu) \label{appeq:average-magnetization-hf-expression}
\end{align}
since $\mathbf{r}\uparrow$ is associated to an odd index entry, while $\mathbf{r}\downarrow$ to the following even entry. \todo

\subsubsection{Hartree-Fock algorithm}

The algorithm proceeds as follows:
\begin{enumerate}
	\setcounter{enumi}{-1}
	\item Algorithm setup: fix
	\begin{enumerate}
		\item the coarse-graining of the $\mathrm{BZ}$ -- which is, fix $L_x$ and $L_y$;
		\item the desired density $n$ {\color{tabred}
			(I still have some doubts on how to treat the $n\neq 1/2$ situation; for now, this algorithm works for $n=1/2$)
		};
		\item the number of iterations $p \in \mathbb{N}$; 
		\item the mixing parameter $g \in [0,1]$;
		\item the tolerance parameter $\delta \in \mathbb{R}$;
	\end{enumerate}
	\item Select a random starting value $m_0 \in [-1,1]$;
	\item Initialize the hamiltonian matrix $H_{\alpha\beta}$ matrix according to the initialized $m_0$ and the site indexing rules of Fig.~\ref{appfig:square-lattice-ordering};
	\item Diagonalize $H_{\alpha\beta}$ matrix collecting the $\mathbf{v}^\ell$ eigenvectors;
	\item Compute $m$ using Eq.~\eqref{appeq:average-magnetization-hf-expression}
	\item Check if $\abs{m-m_0} \le \delta$;
	\begin{itemize}
		\item If yes, halt;
		\item If not, define 
		\[
			m_0 = gm + (1-g)m_0
		\]
		(logical assignment notation used) and repeat from step 2.
	\end{itemize}
\end{enumerate}
{\color{tabred}}
\todo

\subsubsection{Results}
\todo